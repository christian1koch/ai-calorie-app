generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model ConsumedProduct {
  id             Int      @id @default(autoincrement())
  name           String   @unique
  aliases        String   @default("")
  searchText     String
  kcalPer100g    Float
  proteinPer100g Float
  carbsPer100g   Float
  fatPer100g     Float
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([searchText])
}

model MealEntry {
  id               Int      @id @default(autoincrement())
  mealId           Int?
  intent           String   @default("log_meal")
  rawText          String
  item             String
  amountGrams      Float?
  kcal             Float?
  proteinG         Float?
  carbsG           Float?
  fatG             Float?
  source           String
  confidence       String
  assumptions      String
  lookupSourceType String?
  lookupLabel      String?
  agentModel       String?
  berlinDate       String
  berlinTime       String
  timezone         String   @default("Europe/Berlin")
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  meal             Meal?    @relation(fields: [mealId], references: [id], onDelete: SetNull)

  @@index([berlinDate])
  @@index([mealId])
}

model Meal {
  id         Int        @id @default(autoincrement())
  rawText    String
  label      String
  kcal       Float?
  proteinG   Float?
  carbsG     Float?
  fatG       Float?
  confidence String
  assumptions String
  berlinDate String
  berlinTime String
  timezone   String     @default("Europe/Berlin")
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  entries    MealEntry[]

  @@index([berlinDate])
}
